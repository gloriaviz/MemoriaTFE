---
author: "Gloria Vizcaíno Castaño"
date: "23/04/2022"
documentclass: book
forprint: true  # true: imprime a dos caras, false: libro digital
fontsize: 12pt # 10pt,11pt
geometry: margin = 2.5cm 
bibliography: ["bib/export.bib"]
# metodobib -> true: natbib (descomentar: citation_package: natbib) 
#           -> false: pandoc (comentar: citation_package: natbib)
metodobib: true
#natbib: plainnat, abbrvnat, unsrtnat
biblio-style: "plainnat"
#Método 2 (pandoc): descomente una línea de las 2 siguientes en caso de usarlo
#csl: methods-in-ecology-and-evolution.csl      # no numera mejor en las citas
csl: acm-sig-proceedings-long-author-list.csl  # numera peor en las citas
link-citations: yes
output: 
  pdf_document:
    keep_tex: no
    number_sections: yes
    citation_package: natbib  # comentado usa: pandoc-citeproc
    #toc: yes
    fig_caption: yes
    template: latex/templateMemoriaTFE.tex
    includes:
      #before_body: portadas/latex_paginatitulo_modTFE.tex
      #in_header: latex/latex_preambulo.tex
      #after_body: latex/latex_antes_enddoc.tex
---

```{r include=FALSE}
knitr::opts_chunk$set(fig.path = 'figurasR/',
                      echo = FALSE, warning = FALSE, message = FALSE,
                      fig.pos="H",fig.align="center",out.width="95%",
                      cache=FALSE)

```

<!-- \setcounter{chapter}{2} -->

<!-- \setcounter{chapter}{2} escribir 2 para capítulo 3  -->

<!-- \pagenumbering{arabic} -->

```{=tex}
\ifdefined\ifprincipal
\else
\setlength{\parindent}{1em}
\pagestyle{fancy}
\setcounter{tocdepth}{4}
\tableofcontents
```
<!-- \nocite{*} -->

\fi

```{=tex}
\ifdefined\ifdoblecara
\fancyhead{}{}
\fancyhead[LE,RO]{\scriptsize\rightmark}
\fancyfoot[LO,RE]{\scriptsize\slshape \leftmark}
\fancyfoot[C]{}
\fancyfoot[LE,RO]{\footnotesize\thepage}
\else
\fancyhead{}{}
\fancyhead[RO]{\scriptsize\rightmark}
\fancyfoot[LO]{\scriptsize\slshape \leftmark}
\fancyfoot[C]{}
\fancyfoot[RO]{\footnotesize\thepage}
\fi
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
```
# Ilustración sobre datos reales

A la hora de seleccionar una medida de asociación adecuada, hay que tener en cuenta varios criterios. Liebetrau proporciona algunas directrices para seleccionar la medida más apropiada [@Liebetrau1983]:

En primer lugar, nos planteamos si las variables son nominales, ordinales, de intervalo o alguna combinación de las tres. Una medida de asociación para variables de nivel nominal (categóricas) no debería depender de categorías ordenadas. Por otro lado, una medida de asociación para variables de nivel ordinal debería depender de categorías ordenadas, ya que si se ignora el orden de las categorías, se pierde información.

En segundo lugar, ¿se medirá la correlación, la asociación o la concordancia? En general, las medidas asimétricas son adecuadas para la predicción, mientras que las medidas simétricas son apropiadas para la asociación o la correlación, dependiendo del nivel de medición.

En tercer lugar, ¿se va a utilizar la medida de asociación para hacer inferencia? Bajo el modelo poblacional de Neyman-Pearson, esto requiere conocer el error estándar del estimador y a menudo requiere hacer suposiciones sobre la naturaleza de la población, así como un muestreo aleatorio. Bajo el modelo de permutación de Fisher-Pitman, no se requiere conocer el error estándar, no es necesario el muestreo aleatorio, los supuestos de distribución son irrelevantes y las pruebas de permutación dependen completamente de los datos. Las probabilidad basadas en permutaciones pueden ser exactas, basadas en el conjunto de referencia de todas las permutaciones posibles de los datos observados, o aproximadas, basados en una gran muestra aleatoria extraída del conjunto de referencia con el método Monte Carlo.

En cuarto lugar, ¿es la medida de asociación sensible a los cambios de frecuencias marginales? Que la medida de asociación no se altere al multiplicar o dividir una o ambas columnas o filas de la tabla de contingencia por cualquier factor arbitrario es una propiedad muy importante de la medida. En general, los valores de una medida de asociación calculados en dos muestras diferentes no pueden compararse si la medida depende de las frecuencias marginales. Prácticamente todas las medidas de asociación para las variables de nivel nominal y ordinal son sensibles a los cambios de frecuencias marginales. Algunas excepciones notables son la odds ratio, las diferencias porcentuales y la medida de asociación $Q$ de Yule.

En quinto lugar, ¿es la medida de asociación estable ante cambios en el número de categorías? Una medida de asociación estable es aquella en la que el valor no cambia cuando, por ejemplo, el número de categorías se cambia de cinco a cuatro. La medida gamma de asociación ordinal de Goodman y Kruskal es especialmente inestable, mientras que la medida $\tau_b$ de asociación ordinal de Kendall es relativamente estable.

En sexto lugar, ¿es el valor de la medida de asociación fácilmente interpretable? Algunas medidas de asociación tienen interpretaciones claras y significativas, como las medidas de reducción proporcional del error y las medidas corregidas por el azar. Otras medidas no tienen una interpretación significativa, excepto cuando poseen los valores extremos de $0$, $1$ o $-1$. Por ejemplo, la medida simétrica gamma de Goodman y Kruskal de asociación ordinal y las medidas asimétricas $d_{yx}$ y $d_{xy}$ de Somers de asociación ordinal poseen interpretaciones de reducción proporcional en el error, donde los valores positivos indican una mejora proporcional de los errores de predicción con el conocimiento de ambas variables, en comparación de los errores de predicción con el conocimiento de una sola variable. Las medidas kappa no ponderada y kappa ponderada de Cohen para la concordancia y la regla del pie de Spearman poseen interpretaciones corregidas por el azar, en las que los valores positivos indican una concordancia superior a la esperada por el azar y los valores negativos indican una concordancia inferior.

En séptimo lugar, ¿la medida de asociación tiene en cuenta los valores empatados? Algunas medidas de asociación requieren ajustes complicados para usar los valores empatados, mientras que otras incorporan los valores empatados sin ningún ajuste. Por ejemplo, el coeficiente de correlación de rango de Spearman requiere complejos ajustes para los valores empatados.

En octavo lugar, ¿se generalizará fácilmente la medida de asociación para datos multivariantes? El análisis multivariante es cada vez más importante en la investigación, por lo que las medidas de asociación que se adaptan a los datos multivariantes son extremadamente útiles.

En noveno lugar, ¿para qué tipo de asociación asume la medida de asociación su valor extremo? Algunas medidas de asociación asumen sus valores extremos, por ejemplo, $+1$ en casos de asociación débil, como es el caso del estadístico gamma de Goodman y Kruskal. Otras medidas de asociación asumen sus valores extremos sólo en el caso de una asociación perfecta. Por ejemplo, la medida $\tau_b$ de Kendall de asociación ordinal asume un valor de $+1$ sólo cuando existe una asociación extremadamente fuerte.

En décimo lugar, ¿es la medida de asociación fácil de calcular? Algunas medidas de asociación son notoriamente difíciles de calcular. La medida de correlación tetracórica de Pearson para tablas de contingencia $2\times 2$ o la medida de asociación nominal $d^c_N$ de Leik y Gove son de las más dificiles de calcular. Por otro lado, la medida de la regla del pie de Spearman se diseñó específicamente para facilitar su cálculo.

Una vez desarrolladas cada una de las medidas de asociación, tanto nominales como ordinales, y describir los criterios que se usan para seleccionar la más adecuada, se va a proceder a mostrar un caso práctico donde aplicar las diferentes medidas.

## Conjunto de datos

Los datos que se usarán son los datos reales correspondientes a la encuesta sobre tendencias sociales realizada por el Centro de Investigación Sociológica[^1] (C.I.S.) en España del 24 al 30 de noviembre de 2021.

[^1]: <https://www.cis.es/cis/opencm/ES/2_bancodatos/estudios/listaEstudiosYear.jsp?year=2021>

Los datos corresponden a las respuestas de una muestra de 2691 personas procedentes de 888 municipios y 50 provincias. El procedimiento de muestreo fue el siguiente: se seleccionaron aleatoriamente teléfonos fijos y móviles con un porcentaje del 22,0% y del 78,0%, respectivamente. La selección de los individuos se llevó a cabo mediante la aplicación de cuotas de sexo y edad. Los estratos se formaron de forma independiente considerando las 17 comunidades autónomas y las dos ciudades autónomas y el tamaño de hábitat, dividido en 7 categorías: menor o igual a 2.000 habitantes; de 2.001 a 10.000; de 10.001 a 50.000; de 50.001 a 100.000; de 100.001 a 400.000; de 400.001 a 1.000.000; y más de 1.000.000 de habitantes. Los cuestionarios aplicaron mediante entrevista telefónica asistida por ordenador (CATI).

La encuesta está formada por 33 preguntas (véase [Apéndice A](#encuesta-sobre-tendencias-sociales-cuestionario)) y de ella se han extraído las variables más interesantes para estudiar el grado de asociación entre las preguntas. Además, las variables se han limpiado y agrupado para que tengan el menor número de categorías posibles (véase [Apéndice B](#preparacion-de-datos)) para facilitar la interpretación de las medidas.

Las variables ecogidas han sido las siguientes:

**Variables Nominales**

-   SEXO: Sexo de la persona que realiza la encuesta.
-   CCAA: Comunidad Autónoma a la que está empadronada.
-   INESTADO: Respuesta de la persona ante la pregunta ¿debería intervenir el Estado en la vida económica?
-   INFLUPOLITICA: Mayor influencia en las decisiones políticas de los últimos dos años.
-   SISTEMAUTOM1: Cómo afectará al número de parados la utilización de robots y sistemas automáticos de trabajo en los próximos diez años.
-   SIMBOLO: Objeto (artefacto, aparato, máquina) que identifica y simboliza en mayor grado la época actual.
-   IDENTPERSONAS: Grupo de personas con el que piensa el encuestado que tiene más intereses comunes.
-   PARTIDOSIMP: Partido político con el que simpatiza más la persona encuestada.
-   SITLABORAL: Situación laboral en la que se encuentra actualmente.
-   RELIGION: Religión en la que cree la persona encuestada.

**Variables Ordinales**

-   EDAD: Rango de edad de la persona encuestada (intervalos de amplitud 10 años).
-   INTPOLITICO: Grado de interes de la persona por las cuestiones políticas.
-   FUTURO1: Cantidas de cambios sociales y económicos de aquí a diez años según las personas que han realizado la encuesta.
-   FUTURO2: Grado de positividad ante los cambios sociales y económicos producidos de aquí a diez años.
-   SISTEMAUTOM2: Aumento del número de robots y sistemas automáticos en las empresas en los próximos diez años (mucho, bastante, algo, poco, nada o casi nada).
-   ESCIDEOL: Posición que la persona tiene en una escala del 1 al 10 respecto a los ideales políticos, en la que 1 significa "lo más a la izquierda" y 10 "lo más a la derecha".
-   ESTUDIOS: Grado de estudios básicos (No sabe leer ni escribir; no ha ido a la escuela, pero sabe leer y escribir; ha ido a la escuela).
-   OPINION: ¿Las nuevas generaciones vivirán mejor, peor o igual de lo que se ha vivido hasta ahora?
-   CLASESOCIAL: Clase social que mejor define al encuestado.

```{r 1}
library(readr)
X3343 <- read_csv2("MD3343/3343.csv")

# se quitan variables que no interesan
datos = X3343[,c(6,11:14,16,39,48,49,57,58,67,110,112,117,120,121,125,
                 126,128)]

# se agrupan las variables nominales:

for (i in 1:length(datos$IDENTIFIC1)){
if (datos$IDENTIFIC1[i]=="Con las de la misma clase social"){
    datos$IDENTIFIC1[i]="Clase Social"}
else {if (datos$IDENTIFIC1[i]=="Con las de la misma edad y generación") {
      datos$IDENTIFIC1[i]="Generación"}
      else{if (datos$IDENTIFIC1[i]=="Con las de la misma región o nacionalidad" ){
      datos$IDENTIFIC1[i]="Religión/Nacionalidad"}
      else {if (datos$IDENTIFIC1[i]=="Con las del mismo género") {
      datos$IDENTIFIC1[i]="Género"}
      else {if (datos$IDENTIFIC1[i]=="Con las del mismo municipio") {
      datos$IDENTIFIC1[i]="Municipio"}
      else {if (datos$IDENTIFIC1[i]=="Con las que tienen su misma profesión y trabajo"){
      datos$IDENTIFIC1[i]="Profesión/Trabajo"}
      else {if (datos$IDENTIFIC1[i]=="Con las que tienen su misma profesión y trabajo"){
      datos$IDENTIFIC1[i]="Profesión/Trabajo"}
      else {if (datos$IDENTIFIC1[i]=="Con las que tienen sus mismas aficiones, gustos, modas"){
      datos$IDENTIFIC1[i]="Aficiones y Gustos"}
      else {if (datos$IDENTIFIC1[i]=="Con las que tienen sus mismas ideas políticas"){
      datos$IDENTIFIC1[i]="Ideas Políticas"}
      else {if (datos$IDENTIFIC1[i]=="Con las que tienen sus mismas ideas religiosas"){
      datos$IDENTIFIC1[i]="Ideas Religiosas"}
        else{datos$IDENTIFIC1[i]="N.S/N.C"}
      }}}}}}}}
}}

for (i in 1:length(datos$INESTADO1)){
if (datos$INESTADO1[i]=="El Estado no debe intervenir en la vida económica"){
    datos$INESTADO1[i]="No"}
else {if (datos$INESTADO1[i]=="El Estado sí debe intervenir en la economía" ) {
      datos$INESTADO1[i]="Sí"}
          else{datos$INESTADO1[i]="N.S/N.C"}
}
  }

for (i in 1:length(datos$CCAA)){
if (datos$CCAA[i]=="Ceuta (Ciudad Autónoma de)" ){
    datos$CCAA[i]="Ceuta"}
else {if (datos$CCAA[i]=="Murcia (Región de)") {
      datos$CCAA[i]="Murcia"}
      else{if (datos$CCAA[i]=="Comunitat Valenciana"){
      datos$CCAA[i]="Valencia"}
      else {if (datos$CCAA[i]=="Madrid (Comunidad de)") {
      datos$CCAA[i]="Madrid"}
      else {if (datos$CCAA[i]=="Navarra (Comunidad Foral de)") {
      datos$CCAA[i]="Navarra"}
      else {if (datos$CCAA[i]=="Asturias (Principado de)"){
      datos$CCAA[i]="Asturias"}
      else {if (datos$CCAA[i]=="Melilla (Ciudad Autónoma de)"){
      datos$CCAA[i]="Melilla"}
        else{datos$CCAA[i]=datos$CCAA[i]}
      }}}}}
}}

for (i in 1:length(datos$INFLUPOL1)){
if (datos$INFLUPOL1[i]=="Alguna persona concreta (de sus familiares, amigos/as, conocidos/as…)"){
    datos$INFLUPOL1[i]="Conocido Concreto"}
else {if (datos$INFLUPOL1[i]=="La radio") {
      datos$INFLUPOL1[i]="Radio"}
      else{if (datos$INFLUPOL1[i]=="La televisión" ){
      datos$INFLUPOL1[i]="Televisión"}
      else {if (datos$INFLUPOL1[i]=="Las redes sociales, Internet") {
      datos$INFLUPOL1[i]="Internet"}
      else {if (datos$INFLUPOL1[i]=="Los periódicos" |
                datos$INFLUPOL1[i]=="Las revistas" ) {
      datos$INFLUPOL1[i]="Prensa"}
      else {if (datos$INFLUPOL1[i]=="Un/a candidato/a, las actuaciones de los/as candidatos/as"){
      datos$INFLUPOL1[i]="Candidatos"}
      else {if (datos$INFLUPOL1[i]=="Los programas electorales"){
      datos$INFLUPOL1[i]="Prog. Electorales"}
        else{datos$INFLUPOL1[i]="N.S/N.C"}
      }}}}}
}}

for (i in 1:length(datos$SIMBOL1)){
if (datos$SIMBOL1[i]=="El ordenador, el portátil" |
    datos$SIMBOL1[i]=="El software y la informática"){
    datos$SIMBOL1[i]="Odenador e informática"}
      else {if (datos$SIMBOL1[i]=="El robot aspirador y el robot de cocina" | datos$SIMBOL1[i]=="El robot, la robótica, la domótica en general") {
      datos$SIMBOL1[i]="Robot"}
      else {if (datos$SIMBOL1[i]=="Internet, wifi, rúter, fibra, conectividad") {
      datos$SIMBOL1[i]="Internet"}
      else {if (datos$SIMBOL1[i]=="La máquina fabril, la maquinaria industrial y agrícola" ){
      datos$SIMBOL1[i]="Máquina fabril"}
      else {if (datos$SIMBOL1[i]=="La radio"){
      datos$SIMBOL1[i]="Radio"}
      else {if (datos$SIMBOL1[i]=="La televisión y la smart TV"){
      datos$SIMBOL1[i]="Televisión"}
      else {if (datos$SIMBOL1[i]=="Los trenes de alta velocidad" |
                datos$SIMBOL1[i]=="Los medios de transporte en general" |
                datos$SIMBOL1[i]=="El coche, la automoción, el coche eléctrico" |
                datos$SIMBOL1[i]=="El avión"){
      datos$SIMBOL1[i]="Medios Transporte"}
      else {if (datos$SIMBOL1[i]=="Los satélites espaciales, las naves, los viajes espaciales"){
      datos$SIMBOL1[i]="Tema Aeroespacial"}
      else {if (datos$SIMBOL1[i]=="Otros electrodomésticos (freidora, microondas)" | datos$SIMBOL1[i]=="Los electrodomésticos: lavadora,secadora, frigorífico y lavaplatos" |
                datos$SIMBOL1[i]=="Los electrodomésticos para la climatización (aire acondicionado, calefacción)" ){
      datos$SIMBOL1[i]="Electrodomésticos"}
        else{datos$SIMBOL1[i]="N.S/N.C"}
      }}}}}}}
}}

for (i in 1:length(datos$SIMPATIA)){
if (datos$SIMPATIA[i]=="BNG (Bloque Nacionalista Galego)"){
    datos$SIMPATIA[i]="BNG"}
else {if (datos$SIMPATIA[i]=="En Comú Podem" |
          datos$SIMPATIA[i]=="En Común - Unidas Podemos" |
          datos$SIMPATIA[i]=="Unidas Podemos") {
      datos$SIMPATIA[i]="Unidas Podemos"}
      else{if (datos$SIMPATIA[i]=="PACMA (Partido Animalista)"){
      datos$SIMPATIA[i]="PACMA"}
      else {if (datos$SIMPATIA[i]=="PRC (Partido Regionalista de Cantabria)") {
      datos$SIMPATIA[i]="PRC"}
      else {if (datos$SIMPATIA[i]=="Navarra Suma (UPN)") {
      datos$SIMPATIA[i]="Navarra Suma"}
      else {if (datos$SIMPATIA[i]=="Otro" | datos$SIMPATIA[i]=="N.C." |
                datos$SIMPATIA[i]=="Ninguno"){
      datos$SIMPATIA[i]="N.S/N.C"}
        else{datos$SIMPATIA[i]=datos$SIMPATIA[i]}
      }}}}}
}

for (i in 1:length(datos$SITLAB)){
if (datos$SITLAB[i]=="En paro y busca su primer empleo" ){
    datos$SITLAB[i]="Paro y busca primer empleo"}
else {if (datos$SITLAB[i]=="En paro y ha trabajado antes") {
      datos$SITLAB[i]="Paro y ha trabajado"}
      else{if (datos$SITLAB[i]=="Jubilado/a o pensionista 
               (anteriormente ha trabajado)"){
      datos$SITLAB[i]="Jubilado/pensionista (ha trabajado)"}
      else {if (datos$SITLAB[i]=="Pensionista (anteriormente no ha trabajado)" ) {
      datos$SITLAB[i]="Pensionista (no ha trabajado)"}
      else {if (datos$SITLAB[i]=="Navarra (Comunidad Foral de)") {
      datos$SITLAB[i]="Navarra"}
      else {if (datos$SITLAB[i]=="N.C." | datos$SITLAB[i]=="Otra situación"){
      datos$SITLAB[i]="N.C."}
      else {if (datos$SITLAB[i]=="Melilla (Ciudad Autónoma de)"){
      datos$SITLAB[i]="Melilla"}
        else{datos$SITLAB[i]=datos$SITLAB[i]}
      }}}}}
}}

for (i in 1:length(datos$SAT2)){
if (datos$SAT2[i]=="Cree que todo seguirá prácticamente igual, que no influirá en el desempleo" ){
    datos$SAT2[i]="Misma situación"}
else {if (datos$SAT2[i]=="Dará lugar a la creación de más puestos de trabajo" ) {
      datos$SAT2[i]="Más trabajo"}
      else{if (datos$SAT2[i]=="Dará lugar a un aumento del paro"){
      datos$SAT2[i]="Aumento paro"}
        else{datos$SAT2[i]="N.S/N.C."}
      }}
}

for (i in 1:length(datos$P0)){
  if (datos$P0[i]=="La nacionalidad española" ){
      datos$P0[i]="Española"}
  else{datos$P0[i]="Española y otra"}
}

# nueva variable que se estudia en caso concreto:
datos$PARTIDOBLOQUES=rep(1,length(datos$SIMPATIA))

for (i in 1:length(datos$SIMPATIA)){
if (datos$SIMPATIA[i]=="PSOE" | datos$SIMPATIA[i]=="Unidas Podemos"){
    datos$PARTIDOBLOQUES[i]="Bloque Izquierda"}
else {if (datos$SIMPATIA[i]=="PP" | datos$SIMPATIA[i]=="VOX" |
          datos$SIMPATIA[i]=="Ciudadanos") {
      datos$PARTIDOBLOQUES[i]="Bloque Derecha"}
        else{datos$PARTIDOBLOQUES[i]="Otro"}
      }}
        
# se redefinen las variables ordinales para que sigan un "orden"

for (i in 1:length(datos$EDAD)){
if (datos$EDAD[i]<=24){
    datos$EDAD[i]="18-24"}
else {if (datos$EDAD[i]<=34) {
      datos$EDAD[i]="25-34"}
      else{if (datos$EDAD[i]<=44) {
      datos$EDAD[i]="35-44"}
      else {if (datos$EDAD[i]<=54) {
      datos$EDAD[i]="45-54"}
      else {if (datos$EDAD[i]<=64) {
      datos$EDAD[i]="55-64"}
      else {if (datos$EDAD[i]>64) {
      datos$EDAD[i]="65-99"}
          else{datos$EDAD[i]="N.C"}
      }}}}
}}

for (i in 1:length(datos$INTPOL)){
if (datos$INTPOL[i]=="Nada"){
    datos$INTPOL[i]="1-Nada"}
else {if (datos$INTPOL[i]=="Poco") {
      datos$INTPOL[i]="2-Poco"}
      else{if (datos$INTPOL[i]=="Regular") {
      datos$INTPOL[i]="3-Regular"}
      else {if (datos$INTPOL[i]=="Bastante") {
      datos$INTPOL[i]="4-Bastante"}
      else {if (datos$INTPOL[i]=="Mucho") {
      datos$INTPOL[i]="5-Mucho"}
          else{datos$INTPOL[i]="0-N.S/N.C"}
      }}}
}}

for (i in 1:length(datos$FUTUR1)){
if (datos$FUTUR1[i]=="Ningún o casi ningún cambio"){
    datos$FUTUR1[i]="1-Ningún o casi ningún cambio"}
else {if (datos$FUTUR1[i]=="Pocos cambios") {
      datos$FUTUR1[i]="2-Pocos cambios"}
      else{if (datos$FUTUR1[i]=="Regular, ni muchos ni pocos") {
      datos$FUTUR1[i]="3-Regular, ni muchos ni pocos"}
      else {if (datos$FUTUR1[i]=="Bastantes cambios") {
      datos$FUTUR1[i]="4-Bastantes cambios"}
      else {if (datos$FUTUR1[i]=="Muchos cambios") {
      datos$FUTUR1[i]="5-Muchos cambios"}
          else{datos$FUTUR1[i]="0-N.S/N.C"}
      }}}
}}

for (i in 1:length(datos$FUTUR2)){
if (datos$FUTUR2[i]=="Muy negativos"){
    datos$FUTUR2[i]="1-Muy negativos"}
else {if (datos$FUTUR2[i]=="Negativos") {
      datos$FUTUR2[i]="2-Negativos"}
      else{if (datos$FUTUR2[i]=="En parte positivos y en parte negativos" |
               datos$FUTUR2[i]=="Indiferentes"){
      datos$FUTUR2[i]="3-Indiferentes"}
      else {if (datos$FUTUR2[i]=="Positivos") {
      datos$FUTUR2[i]="4-Positivos"}
      else {if (datos$FUTUR2[i]=="Muy positivos") {
      datos$FUTUR2[i]="5-Muy positivos"}
        else{datos$FUTUR2[i]="0-N.S/N.C"}
      }}}
}}

for (i in 1:length(datos$CLASESUB)){
if (datos$CLASESUB[i]=="Clase baja/pobre"){
    datos$CLASESUB[i]="1-Clase baja/pobre"}
else {if (datos$CLASESUB[i]=="Clase trabajadora/obrera/proletariado") {
      datos$CLASESUB[i]="2-Clase trabajadora/obrera/proletariado"}
      else{if (datos$CLASESUB[i]=="Clase media-baja"){
      datos$CLASESUB[i]="3-Clase media-baja"}
      else {if (datos$CLASESUB[i]=="Clase media-media") {
      datos$CLASESUB[i]="4-Clase media-media"}
      else {if (datos$CLASESUB[i]=="Clase alta y media alta") {
      datos$CLASESUB[i]="5-Clase alta y media alta"}
        else{datos$CLASESUB[i]="0-N.S/N.C"}
      }}}
}}

for (i in 1:length(datos$ESCIDEOL)){
if (datos$ESCIDEOL[i]=="1 Izquierda") {
    datos$ESCIDEOL[i]="01 Izquierda"}
else {if (datos$ESCIDEOL[i]=="2"){
  datos$ESCIDEOL[i]="02"}
      else{if (datos$ESCIDEOL[i]=="3"){
      datos$ESCIDEOL[i]="03"}
      else {if (datos$ESCIDEOL[i]=="4") {
      datos$ESCIDEOL[i]="04"}
      else {if (datos$ESCIDEOL[i]=="5") {
      datos$ESCIDEOL[i]="05"}
      else {if (datos$ESCIDEOL[i]=="6"){
      datos$ESCIDEOL[i]="06"}
      else {if (datos$ESCIDEOL[i]=="7") {
      datos$ESCIDEOL[i]="07"}
      else {if (datos$ESCIDEOL[i]=="8") {
      datos$ESCIDEOL[i]="08"}
      else {if (datos$ESCIDEOL[i]=="9"){
      datos$ESCIDEOL[i]="09"}
      else {if (datos$ESCIDEOL[i]=="10 Derecha"){
      datos$ESCIDEOL[i]="10 Derecha"}
else {datos$ESCIDEOL[i]="0-N.S./N.C."}}
      }}}}}}}}}


for (i in 1:length(datos$ESTUDIOS)){
if (datos$ESTUDIOS[i]=="Sin estudios"){
    datos$ESTUDIOS[i]="1-Sin estudios"}
else {if (datos$ESTUDIOS[i]=="Primaria") {
      datos$ESTUDIOS[i]="2-Primaria"}
      else{if (datos$ESTUDIOS[i]=="Secundaria 1ª etapa"){
      datos$ESTUDIOS[i]="3-Secundaria 1ª etapa"}
      else {if (datos$ESTUDIOS[i]=="Secundaria 2ª etapa") {
      datos$ESTUDIOS[i]="4-Secundaria 2ª etapa"}
      else {if (datos$ESTUDIOS[i]=="F.P." | datos$ESTUDIOS[i]=="Otros") {
      datos$ESTUDIOS[i]="5-F.P. y otros no superiores"}
      else {if (datos$ESTUDIOS[i]=="Superiores"){
      datos$ESTUDIOS[i]="6-Superiores"}
        else{datos$ESTUDIOS[i]="0-N.C"}
      }}}}
}}

for (i in 1:length(datos$OPINION)){
if (datos$OPINION[i]=="Peor"){
    datos$OPINION[i]="1-Peor"}
else {if (datos$OPINION[i]=="Igual") {
      datos$OPINION[i]="2-Igual"}
      else{if (datos$OPINION[i]=="Mejor") {
           datos$OPINION[i]="3-Mejor"}
           else {datos$OPINION[i]="0-N.S/Duda/N.C"}
      }
}}

for (i in 1:length(datos$SAT1)){
if (datos$SAT1[i]=="No aumentarán nada o casi nada"){
    datos$SAT1[i]="1-No aumentarán nada o casi nada"}
else {if (datos$SAT1[i]=="Aumentarán poco") {
      datos$SAT1[i]="2-Aumentarán poco"}
      else{if (datos$SAT1[i]=="Aumentarán algo"){
      datos$SAT1[i]="3-Aumentarán algo"}
      else {if (datos$SAT1[i]=="Aumentarán bastante") {
      datos$SAT1[i]="4-Aumentarán bastante"}
      else {if (datos$SAT1[i]=="Aumentarán mucho") {
      datos$SAT1[i]="5-Aumentarán muchos"}
        else{datos$SAT1[i]="0-N.S/N.C"}
      }}}
}}

names(datos)=c("CCAA","SEXO","EDAD","NACIONALIDAD","INTPOLITICO",
               "INESTADO","INFLUPOLITICA","FUTURO1","FUTURO2",
               "SISTEMAUTOM2","SISTEMAUTOM1","SIMBOLO","IDENTPERSONAS",
               "ESCIDEOL","PARTIDOSIMP","ESTUDIOS","SITLABORAL",
               "RELIGION","OPINION","CLASESOCIAL","PARTIDOBLOQUES")

# Ponemos las variables categoricas como factores y las ordinales como 
# factores ordenados:
datos$CCAA=as.factor(datos$CCAA)
datos$SEXO=as.factor(datos$SEXO)
datos$EDAD=as.ordered(datos$EDAD)
datos$NACIONALIDAD=as.factor(datos$NACIONALIDAD)
datos$INTPOLITICO=as.ordered(datos$INTPOLITICO)
datos$INESTADO=as.factor(datos$INESTADO)
datos$INFLUPOLITICA=as.factor(datos$INFLUPOLITICA)
datos$FUTURO1=as.ordered(datos$FUTURO1)
datos$FUTURO2=as.ordered(datos$FUTURO2)
datos$SISTEMAUTOM2=as.ordered(datos$SISTEMAUTOM2)
datos$SISTEMAUTOM1=as.factor(datos$SISTEMAUTOM1)
datos$SIMBOLO=as.factor(datos$SIMBOLO)
datos$IDENTPERSONAS=as.factor(datos$IDENTPERSONAS)
datos$ESCIDEOL=as.ordered(datos$ESCIDEOL)
datos$PARTIDOSIMP=as.factor(datos$PARTIDOSIMP)
datos$ESTUDIOS=as.ordered(datos$ESTUDIOS)
datos$SITLABORAL=as.factor(datos$SITLABORAL)
datos$RELIGION=as.factor(datos$RELIGION)
datos$CLASESOCIAL=as.ordered(datos$CLASESOCIAL)
datos$OPINION=as.ordered(datos$OPINION)
datos$PARTIDOBLOQUES=as.factor(datos$PARTIDOBLOQUES)

# lo guardamos:

save(datos,file="C:/Users/glori/OneDrive - UNIVERSIDAD DE SEVILLA/Escritorio/MemoriaTFEGloriaVizcaino/datos.Rdata")

# save(datos,file="C:/Users/Escritorio/MemoriaTFEGloriaVizcaino/
#                  datos.Rdata")

load("datos.Rdata")
```

## Medidas de Asociación para Variables Nominales

Se realizará un análisis descriptivo y se aplicarán las diferentes medidas de asociación, creadas para variables categóricas, a los siguientes pares de variables:

-   SEXO - IDENTPERSONAS

-   SEXO - INESTADO

-   CCAA - SIMBOLO

-   RELIGION - PARTIDOSIMP

-   SITLABORAL - SISTEMAUTOM1

-   INFLUPOLITICA - PARTIDOSIMP

-   INESTADO - PARTIDOSIMP

Para así, conocer el grado de asociación entre ellas y poder comparar las distintas medidas.

### SEXO - IDENTPERSONAS

En primer lugar, se estudia si a partir del sexo de la persona se puede predecir el grupo de personas con el que tiene más intereses comunes.

Un resumen de los datos muestrales se observa en la siguiente tabla, donde aparece el total de personas para cada categoría de la variable IDENTPERSONAS diferenciado por la variable SEXO. Además, también aparece el porcentaje para ambos sexos de cada una de las categorías:

```{r 2}
library(dplyr)

d2 <- datos %>%
group_by(IDENTPERSONAS,SEXO) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

library(knitr)
library(kableExtra)

kable(d2,caption ="Variables IDENTPERSONAS y SEXO",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header",
                                  "condensed","hold_position"), 
                repeat_header_text="(contin\\'ua)",
                position = "center",full_width = FALSE)
```

A continuación, se representan dichos datos en un gráfico de barras para facilitar su interpretación:

```{r 3, echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:nom1} Gráfico de barras SEXO-IDENTPERSONAS",fig.pos="H"}
library(ggplot2)

ggplot(data = d2,
       mapping = aes(x = factor(IDENTPERSONAS),y = Porcentaje*100,
                     fill = factor(SEXO))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "Indentificación con sus mismos/as...", y = "Porcentaje", 
       fill = "Sexo") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5)) +
  scale_fill_manual(values=c("#AEEEEE","#7A67EE"))
```

A través del gráfico, se intuye que no habrá demasiada asociación entre las dos variables, ya que parece que la variable SEXO no influye demasiado en la categoría de la variable IDENTPERSONAS. Las categorías que están más diferenciadas por el sexo son: Género, Clase Social y Municipio.

Para calcular las diferentes medidas de asociación se considera que la variable dependiente es IDENTPERSONAS.

Las diferentes medidas obtenidas se observan en la siguiente tabla:

```{r 4}
tabla1=table(datos$IDENTPERSONAS,datos$SEXO)
tabla1=tabla1[-8,] #quitar los N.S/N.C

library(DescTools)
a1=Lambda(tabla1, direction="column", conf.level = 0.95) 
#en dirección va la independiente
b1=GoodmanKruskalTau(tabla1, direction="column", conf.level = 0.95)

c1=rbind.data.frame(a1,b1)
rownames(c1)=c("$\\lambda$ de Goodman y Krukal","$t$ de Goodman y Kruskal")
colnames(c1)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(c1,caption ="Medidas de variables IDENTPERSONAS y SEXO", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Se observa que ambas medidas, tanto la $\lambda$ como la $t$ de Goodman y Kruskal, presentan valores cercanos a $0$, es decir, la asociación entre ambas variables no es demasiado significativa. Aunque cabe destacar que como el $0$ no pertenece al intervalo de confianza, la asociación tampoco se consideraría nula.

Como se observó en el gráfico \ref{fig:nom1}, las variables en las que el sexo toma un papel más importante son Género, Municipio y Clase Social. A continuación, se calculan de nuevos estas medidas usando únicamente esas categorías de la variable IDENTPERSONAS:

```{r 6}
tabla1a=tabla1[c(2,4,7),]
a2=Lambda(tabla1a, direction="column", conf.level = 0.95) 
b2=GoodmanKruskalTau(tabla1a, direction="column", conf.level = 0.95)

c2=rbind.data.frame(a2,b2)
rownames(c2)=c("$\\lambda$ de Goodman y Krukal","$t$ de Goodman y Kruskal")
colnames(c2)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(c2,caption ="Medidas de variables IDENTPERSONAS y SEXO (2)", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Se puede ver cómo ambas medidas han aumentado considerablemente sus valores, y por tanto, restringiénsonos a estas categorías, se obtiene que el conocimiento de los valores de la variable SEXO permite reducir la incertidumbre en la predicción del comportamiento de la variable IDENTPERSONAS en un 42% y un 22,44%, respectivamente.

### SEXO - INESTADO

Igualmente, se plantea ahora si la variable sexo influye en la respuesta de cada persona a la pregunta ¿debería intervenir el Estado en la vida económica? y viceversa.

Realizando el mismo proceso, se obtiene la tabla:

```{r 7}
d3 <- datos %>%
group_by(INESTADO,SEXO) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

kable(d3,caption ="Variables INESTADO y SEXO",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE)

```

Y el gráfico:

```{r 8, echo=FALSE,out.width='10cm',fig.align='center',fig.cap="\\label{fig:nom2} Gráfico de barras SEXO-INESTADO",fig.pos="H"}

ggplot(data = d3,
       mapping = aes(x = factor(INESTADO),y = Porcentaje*100, 
                     fill = factor(SEXO))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "¿Debería el Estado intervenir en la vida económica? ", 
       y = "Porcentaje", fill = "Sexo") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5)) +
  scale_fill_manual(values=c("#AEEEEE","#7A67EE"))
```

Mediante el análisis descriptivo no hay signos de que haya asociación entre las variables. Esto se comprueba con los valores que obtenemos al calcular las medidas de asociación siguientes:

```{r 9}
tabla2=table(datos$INESTADO,datos$SEXO)
tabla2=tabla2[-1,] #quitar los N.S/N.C

a3.1=Lambda(tabla2, direction="column", conf.level = 0.95)
a3.2=Lambda(tabla2, direction="row", conf.level = 0.95)
b3.1=GoodmanKruskalTau(tabla2, direction="column", conf.level = 0.95)
b3.2=GoodmanKruskalTau(tabla2, direction="row", conf.level = 0.95)

c3=rbind.data.frame(a3.1,a3.2,b3.1,b3.2)
rownames(c3)=c("$\\lambda_{INESTADO}$ de Goodman y Krukal","$\\lambda_{SEXO}$ de Goodman y Krukal","$t_{INESTADO}$ de Goodman y Kruskal", "$t_{SEXO}$ de Goodman y Kruskal")
colnames(c3)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(c3,caption ="Medidas de variables INESTADO y SEXO", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Mediante este ejemplo, se puede observar la particularidad de que $\lambda$ puede tomar el valor de $0$ para casos distintos a la independencia. En este caso se ha obtenido la tabla de contingencia:

```{r 10}
kable(tabla2,longtable=TRUE) %>%
   kable_styling(position = "center")
```

En esta situación, la moda de la categorías de INESTADO coinciden que son la misma categoría de la variable SEXO (Hombre), por tanto, $$
W=\sum_{i=1}^2max(n_{i1},n_{i2})=350+932=1282; ~~~~~~A=max(n_{.1},n_{.2})=1282
$$ y así, $$
\lambda_{INESTADO}=\frac{W-A}{N-A}=0~.
$$ Análogamente, la moda de la categorías de SEXO coinciden que son la misma categoría de la variable INESTADO (Sí), por tanto, $$
Z=\sum_{j=1}^2max(n_{1j},n_{2j})=932+930=1862; ~~~~~~B=max(n_{1.},n_{2.})=1862
$$ y así, $$
\lambda_{SEXO}=\frac{Z-B}{N-B}=0~.
$$

### CCAA - SIMBOLO

A continuación, se plantea la cuestión de si hay relación entre la elección del símbolo que mejor define la época actual y la comunidad autónoma a la que pertenecen los encuestados. Gráficamente:

```{r 11}
tabla4=table(datos$SIMBOLO,datos$CCAA)
tabla4=tabla4[-5,] #quitar los N.S/N.C

# kable(tabla4[,1:6],longtable=TRUE) %>%
#   row_spec(0, bold=T, background='gray!6',align='c') %>%
#   kable_styling(position = "center",full_width = T)
# kable(tabla4[,7:12],longtable=TRUE) %>%
#   row_spec(0, bold=T, background='gray!6',align='c') %>%
#   kable_styling(position = "center",full_width = T)
# kable(tabla4[,13:19],longtable=TRUE) %>%
#   row_spec(0, bold=T, background='gray!6',align='c') %>%
#   kable_styling(position = "center",full_width = T)
```

```{r 12}
d5 <- datos %>%
group_by(SIMBOLO,CCAA) %>% # agrupa por variables
summarise(Total=n()) %>%# resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

# Esta tabla es demasiado grande, mejor no mostrarla

# kable(d5,caption ="Variables SÍMBOLO y CCAA") %>%
#   kable_styling(latex_options = c("striped", "condensed","hold_position"),
# position = "center",
# full_width = FALSE) 

```

```{r 13, echo=FALSE,out.width='14cm',fig.align='center',fig.cap="\\label{fig:nom4} Gráfico de barras CCAA-SÍMBOLO",fig.pos="H"}

d5=d5[-(51:69),]
ggplot(data = d5,
       mapping = aes(x = factor(SIMBOLO),y = Porcentaje, 
                     fill = factor(CCAA))) + 
  geom_bar(colour="black", stat = 'identity') +
  labs(x = "El símbolo que mejor define la época actual es...", 
       y = "Total", fill = "CCAA") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5), 
        legend.key.height = unit (0.35, 'cm')) 
```

Las medidas se asociación aparecen recogidas en la siguiente tabla:

```{r 14}

a5.1=Lambda(tabla4, direction="column", conf.level = 0.95)
b5.1=GoodmanKruskalTau(tabla4, direction="column", conf.level = 0.95)
a5.2=Lambda(tabla4, direction="row", conf.level = 0.95)
b5.2=GoodmanKruskalTau(tabla4, direction="row", conf.level = 0.95)

c5=rbind.data.frame(a5.1,a5.2,b5.1,b5.2)
rownames(c5)=c("$\\lambda_{SIMBOLO}$ de Goodman y Krukal","$\\lambda_{CCAA}$ de Goodman y Krukal","$t_{SIMBOLO}$ de Goodman y Kruskal","$t_{CCAA}$ de Goodman y Kruskal")
colnames(c5)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(c5,caption ="Medidas de variables SIMBOLO y CCAA", 
      row.names = T,escape = FALSE, digits = rep(4,3), longtable=T) %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
                position = "center",repeat_header_text="(contin\\'ua)", 
                full_width = FALSE)
```

Sin importar qué variable se tome como dependiente, no hay evidencias para rechazar la hipótesis nula de que $\lambda=0$, y por tanto, con esta medida las variables SIMBOLO y CCAA no presentan asociación. Sin embargo, con la medida $t$ de Goodman y Kruskal, la asociación sí es significativa aunque con el conocimiento de las variables CCAA y SIMBOLO sólo permite reducir la incertidumbre en la predicción del comportamiento de la otra variable en un 0,68% y un 1,62%, respectivamente.

### RELIGION - PARTIDOSIMP

Seguidamente se cuantifica la asociación entre las creencias religiosas y los partidos políticos más afines a los entrevistados.

Análisis descriptivo:

```{r 15}
d7 <- datos %>%
group_by(PARTIDOSIMP,RELIGION) %>% # agrupa por variables
summarise(Total=n()) %>%# resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4)) 

d7=d7[-c(9,17,25,36:40,46,56,62,67),]

kable(d7,caption ="Variables PARTIDOSIMP y RELIGIÓN",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)", full_width = FALSE)
```

Esta vez, no se representan los porcentajes, sino las frecuencias absolutas. Así se ve también cuáles son los partidos mayoritarios:

```{r 16, echo=FALSE,out.width='17cm',fig.align='center',fig.cap="\\label{fig:nom6} Gráfico de barras RELIGIÓN-PARTIDOSIMP",fig.pos="H"}

ggplot(data = d7,
       mapping = aes(x = factor(PARTIDOSIMP),y = Total, 
                     fill = factor(RELIGION))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "¿Qué partido es con el que más simpatizas? ", 
       y = "Total", fill = "Religión") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5)) 
```

Considerando la variable PARTIDOSIMP como la variable dependiente, se obtienen las siguientes medidas:

```{r 17}
tabla6=table(datos$PARTIDOSIMP,datos$RELIGION)
tabla6=tabla6[-11,-5] #quitar los N.S/N.C

a8=Lambda(tabla6, direction="column", conf.level = 0.95)
b8=GoodmanKruskalTau(tabla6, direction="column", conf.level = 0.95)

c8=rbind.data.frame(a8,b8)
rownames(c8)=c("$\\lambda$ de Goodman y Krukal","$t$ de Goodman y Kruskal")
colnames(c8)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(c8,caption ="Medidas de variables PARIDOSIMP y RELIGION", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Se puede considerar que hay asociación entre las variables RELIGIÓN y PARTIDOSIMP. Más concretamente, el conocimiento de los valores de la variable RELIGION permite reducir la incertidumbre en la predicción de la variable PARTIDOSIMP en un 21,82% y un 12,76%, considerando las medidas $\lambda$ y $t$ de Goodman y Kruskal respectivamente.

### SITLABORAL - SISTEMAUTOM1

Se plantea ahora la cuestión de si a través de la situación laboral se puede predecir cómo afectará al número de parados la utilización de robots y sistemas automáticos de trabajo en los próximos diez años.

Los datos muestrales son los siguientes:

```{r 18}
d8 <- datos %>%
group_by(SISTEMAUTOM1,SITLABORAL) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

kable(d8,caption ="Variables SISTEMAUTOM1 y SITLABORAL",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE) %>%
column_spec(2,width = "7cm")

```

A través de ellos, se obtiene el gráfico:

```{r 19, echo=FALSE,out.width='17cm',fig.align='center',fig.cap="\\label{fig:nom7} Gráfico de barras SITLABORAL-SISTEMAUTOM1",fig.pos="H"}

ggplot(data = d8,
       mapping = aes(x = factor(SISTEMAUTOM1),y = Porcentaje, 
                     fill = factor(SITLABORAL))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "La utilización de robots y sistemas automáticos 
       va a ser causa en los próximos años de...", 
       y = "Porcentaje", fill = "Situación Laboral") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5))
```

Las medidas de asociación que se obtienen, considerando la variable SISTEMAUTOM1, son:

```{r 20}
tabla7=table(datos$SISTEMAUTOM1,datos$SITLABORAL)
tabla7=tabla7[-4,-3] #quitar los N.S/N.C

a9=Lambda(tabla7, direction="column", conf.level = 0.95)
b9=GoodmanKruskalTau(tabla7, direction="column", conf.level = 0.95)

c9=rbind.data.frame(a9,b9)
rownames(c9)=c("$\\lambda$ de Goodman y Krukal","$t$ de Goodman y Kruskal")
colnames(c9)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(c9,caption ="Medidas de variables SISTEMAUTOM1 y SITLABORAL", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Como $\lambda = 0$, indica que el conocimiento de los valores de una variable no permite predecir el comportamiento de la otra variable.

El estadístico $t$ de Goodman toma el valor de $0.0092$, este resultado confirma las conclusiones comentadas justo antes.

\bigskip

Se obtienen las respectivas asociaciones correspondientes a varios aspectos políticos:

### INFLUPOLITICA - PARTIDOSIMP

Se consideran únicamente los partidos que obtuvieron más votos, es decir, PSOE, PP, Unidas Podemos, VOX y Ciudadanos; y se observa si existe relación con cuál ha sido la mayor influencia en las decisiones políticas de los últimos dos años.

```{r 21}
d10 <- datos %>%
group_by(PARTIDOSIMP,INFLUPOLITICA) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))
d10=d10[c(8:15,81:88,90:97,99:114),]
kable(d10,caption ="Variables PARTIDOSIMP y INFLUPOLITICA",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE)
```

```{r 22, echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:nom9} Gráfico de barras INFLUPOLITICA-PARTIDOSIMP",fig.pos="H"}

ggplot(data = d10,
       mapping = aes(x = factor(PARTIDOSIMP),y = Porcentaje*100, 
                     fill = factor(INFLUPOLITICA))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "¿Qué partido es con el que más simpatizas?", 
       y = "Porcentaje", fill = "Mayor Influencia") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5))
```

Observando el gráfico, parece que para los principales partidos, la influencia en las decisiones políticas es similar; por lo que debería traducirse en que que no hay (o hay poca asociación) entre ambas variables. Esto se verifica a través de las medidas de asociación:

```{r 23}
tabla9=table(datos$PARTIDOSIMP,datos$INFLUPOLITICA)
tabla9=tabla9[c(3,14,16,18,19),] #escoger los partidos con más votos

a11=Lambda(tabla9, direction="column", conf.level = 0.95)
b11=GoodmanKruskalTau(tabla9, direction="column", conf.level = 0.95)

c11=rbind.data.frame(a11,b11)
rownames(c11)=c("$\\lambda$ de Goodman y Krukal","$t$ de Goodman y Kruskal")
colnames(c11)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(c11,caption ="Medidas de variables PARTIDOSIMP e INFLUPOLITICA", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

### INESTADO - PARTIDOSIMP

Para finalizar con las medidas de asociación nominal, se estudia la asociación entre la elección del martido más afín a la persona y su opición sobre si el Estado debería intervenir en la vida económica.

Un resumen se los datos se muestra en la siguiente tabla y gráfico:

```{r 24}
d11 <- datos %>%
group_by(PARTIDOSIMP,INESTADO) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))
d11=d11[c(5,6,31,32,35,36,39,40,42,43),]
kable(d11,caption ="Variables PARTIDOSIMP y INESTADO",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE)
```

```{r 25, echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:nom10} Gráfico de barras INESTADO-PARTIDOSIMP",fig.pos="H"}

ggplot(data = d11,
       mapping = aes(x = factor(PARTIDOSIMP),y = Porcentaje*100, 
                     fill = factor(INESTADO))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "¿Qué partido es con el que más simpatizas?", 
       y = "Porcentaje", fill = "¿Debería el Estado intervenir \n en la vida económica?") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5)) +
  scale_fill_manual(values=c("#AEEEEE","#7A67EE"))
```

Las medidas de asociación que se obtienen son:

```{r 26}
tabla11=table(datos$PARTIDOSIMP,datos$INESTADO)
tabla11=tabla11[c(3,14,16,18,19),-1] #escoger los partidos con más votos

a12.1=Lambda(tabla11, direction="column", conf.level = 0.95)
a12.2=Lambda(tabla11, direction="row", conf.level = 0.95)
b12.1=GoodmanKruskalTau(tabla11, direction="column", conf.level = 0.95)
b12.2=GoodmanKruskalTau(tabla11, direction="row", conf.level = 0.95)

c12=rbind.data.frame(a12.1,a12.2,b12.1,b12.2)
rownames(c12)=c("$\\lambda_{PARIDOSIMP}$ de Goodman y Krukal","$\\lambda_{INESTADO}$ de Goodman y Krukal","$t_{PARIDOSIMP}$ de Goodman y Kruskal","$t_{INESTADO}$ de Goodman y Kruskal")
colnames(c12)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(c12,caption ="Medidas de variables PARTIDOSIMP e INESTADO", 
      row.names = T,escape = FALSE, digits = rep(4,3),longtable=T)%>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
                position = "center",repeat_header_text="(contin\\'ua)", 
                full_width = T)
```

Tomando la variable PARIDOSIMP como dependiente , $\lambda = 0.0219$. Así pues, el conocimiento de los valores de la variable PARIDOSIMP permite reducir la incertidumbre en la predicción del comportamiento de la variable INESTADO en un 2.19%, pero como el $0$ pertenece al intervalo de confianza, se puede concluir que la asociación no es significativa usando esta medida. Por el contrario, usando la medida $t$ de Goodman y Kruskal, la asociación sí que es evidente y en este caso, el conocimiento de los valores de la variable PARIDOSIMP permite reducir la incertidumbre en la predicción del comportamiento de la variable INESTADO en un 18.96%.

Tomando la variable INESTADO como dependiente, ambas medidas son significativas. $\lambda=0.1074$ y $t=0.0574$ así, el conocimiento de los valores de la variable INESTADO permite reducir la incertidumbre en la predicción del comportamiento de la variable PARIDOSIMP en un 10.74% y un 5,74% respectivamente.

\bigskip

Es de destacar que las medidas obtenidas no describen del todo bien el comportamiento del gráfico, ya que se observa gran relación entre estas variables. Por tanto, se da un paso más y se agrupan los partidos en los bloques de izquierda (PSOE y Unidas Podemos) y derecha (PP, Vox y Ciudadanos), para así calcular de nuevo dichas medidas:

```{r 27}
tabla11.=table(datos$PARTIDOBLOQUES,datos$INESTADO)
tabla11.=tabla11.[-3,-1]

a13.1=Lambda(tabla11., direction="column", conf.level = 0.95)
a13.2=Lambda(tabla11., direction="row", conf.level = 0.95)
b13.1=GoodmanKruskalTau(tabla11., direction="column", conf.level = 0.95)
b13.2=GoodmanKruskalTau(tabla11., direction="row", conf.level = 0.95)

c13=rbind.data.frame(a13.1,a13.2,b13.1,b13.2)
rownames(c13)=c("$\\lambda_{PARTIDOSIMP}$ de Goodman y Krukal","$\\lambda_{INESTADO}$ de Goodman y Krukal","$t_{PARTIDOSIMP}$ de Goodman y Kruskal","$t_{INESTADO}$ de Goodman y Kruskal")
colnames(c13)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(c13,caption ="Medidas de variables PARTIDOSIMP e INESTADO (2)", 
      row.names = T,escape = FALSE, digits = rep(4,3), longtable=T)%>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
                position = "center",repeat_header_text="(contin\\'ua)", 
                full_width = T)
```

En este caso, que $\lambda_{PARTIDOSIMP}$ sea $0$ no es porque no exista asociación, se debe a la problemática ya vista anteriormente de que la moda de los dos bloques ideológicos coinciden que son la misma categoría de la variable INESTADO (Sí).

En las demás medidas el grado de asociación sí que ha aumentado considerablemente.

## Medidas de Asociación para Variables Ordinales

La función *cor* también se puede aplicar a variables de tipo ordinal usando la medida $\tau$ de Kendall, por eso, antes que nada, se examina el gráfico de correlaciones para aplicar las medidas de asociación ordinal entre las variables más interesantes.

```{r 28, echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:corrplot} Gráfico de correlaciones método Kendall",fig.pos="H"}
cor=cor(apply(datos[,c(3,5,8:10,14,16,19,20)],2,xtfrm),method = "kendall")

library(corrplot)
corrplot(cor,title = "Correlación entre Variables Ordinales",tl.cex = 0.7, tl.col = "black")

```

Se observa que la asociación no es extremadamente fuerte para ningún par de variables, además, cabe destacar que hay variables que presentan asociación tanto positiva como negativa.

Al igual que para las variables nominales, se realizará un análisis descriptivo y se aplicarán las diferentes medidas de asociación a cada uno de los siguientes pares de variables:

-   EDAD - ESTUDIOS

-   ESTUDIOS - INTPOLITICO

-   OPINION - FUTURO2

-   CLASESOCIAL - ESTUDIOS

-   ESCIDEOL - EDAD

-   SISTEMAUTOM2 - FUTURO1

-   ESCIDEOL - CLASESOCIAL

Para así, conocer el grado de asociación entre ellas y poder comparar las distintas medidas.

### EDAD - ESTUDIOS

En primer lugar, se va a analizar si a partir del nivel de estudios de la persona se puede predecir a qué grupo de edad pertenece y viceversa.

Un resumen de los datos muestrales se observa en la siguiente tabla:

```{r 29}
d1_ <- datos %>%
group_by(EDAD,ESTUDIOS) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

kable(d1_,caption ="Variables EDAD y ESTUDIOS",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE)
```

Se representan en la siguiente figura:

```{r 30, echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:ord1} Gráfico de barras EDAD-ESTUDIOS",fig.pos="H"}

ggplot(data = d1_,
       mapping = aes(x = factor(EDAD),y = Porcentaje*100,
                     fill = factor(ESTUDIOS))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "Nivel de estudios según edad", y = "Porcentaje", 
       fill = "Nivel de Estudios") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5))
```

Las diferentes medidas de asociación ordinal se recogen en la tabla:

```{r 31}
tabla1_=table(datos$EDAD,datos$ESTUDIOS)
tabla1_=tabla1_[,-1]

e1=KendallTauA(tabla1_, conf.level = 0.95)
f1=KendallTauB(tabla1_, conf.level = 0.95)
g1=StuartTauC(tabla1_, conf.level = 0.95)
h1=GoodmanKruskalGamma(tabla1_, conf.level = 0.95)
i1=SomersDelta(tabla1_, direction="column", conf.level = 0.95)
j1=SomersDelta(tabla1_, direction="row", conf.level = 0.95)

k1=rbind.data.frame(e1,f1,g1,h1,i1,j1)
rownames(k1)=c("$\\tau_a$ de Kendall","$\\tau_b$ de Kendall",
               "$\\tau_c$ de Stuart","$\\gamma$ de Goodman y Kruskal",
               "$d_{EDAD}$ de Sommers","$d_{ESTUDIOS}$ de Sommers")
colnames(k1)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(k1,caption ="Medidas de variables EDAD y ESTUDIOS", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Todas las medidas son negativas, es decir, existe asociación y es negativa (a medida que aumenta el grupo de edad es menor el nivel de estudios). Las diferentes medidas son relativamente parecidas en cuanto a los valores que toman y van desde -0.2127, la $\gamma$ de Goodman y Kruskal, hasta -0.124, la $\tau_a$ de Kendall. La asociación es significativa en todas ellas.

### ESTUDIOS - INTPOLITICO

A continuación, se examina si es posible conocer el nivel de estudios a partir del interés hacia la política de la persona .

```{r}
d2_ <- datos %>%
group_by(ESTUDIOS,INTPOLITICO) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

kable(d2_,caption ="Variables ESTUDIOS e INTPOLITICO",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE)
```

Gráficamente:

```{r echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:ord2} Gráfico de barras ESTUDIOS-INTPOLITICO",fig.pos="H"}

ggplot(data = d2_[-c(1,2),],
       mapping = aes(x = factor(ESTUDIOS),y = Porcentaje*100,
                     fill = factor(INTPOLITICO))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "Nivel de Estudios", y = "Porcentaje", 
       fill = "Interés Político") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5))
```

Las medidas de asociación que se obtienen son las siguientes:

```{r}
tabla2_=table(datos$ESTUDIOS,datos$INTPOLITICO)
tabla2_=tabla1_[-1,-1]

e2=KendallTauA(tabla2_, conf.level = 0.95)
f2=KendallTauB(tabla2_, conf.level = 0.95)
g2=StuartTauC(tabla2_, conf.level = 0.95)
h2=GoodmanKruskalGamma(tabla2_, conf.level = 0.95)
i2=SomersDelta(tabla2_, direction="column", conf.level = 0.95)
j2=SomersDelta(tabla2_, direction="row", conf.level = 0.95)

k2=rbind.data.frame(e2,f2,g2,h2,i2,j2)
rownames(k2)=c("$\\tau_a$ de Kendall","$\\tau_b$ de Kendall",
               "$\\tau_c$ de Stuart","$\\gamma$ de Goodman y Kruskal",
               "$d_{ESTUDIOS}$ de Sommers","$d_{INTPOLITICO}$ de Sommers")
colnames(k2)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(k2,caption ="Medidas de variables ESTUDIOS e INTPOLITICO", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

¿Esto tiene sentido que salga negativo? En el gráfico de correlación salía positivo.

### OPINION - FUTURO2

Se estudia ahora si existe relación entre el pensamiento de cómo vivirán las nuevas generaciones y el grado de positividad ante cambios en 10 años. Los datos muestrales se pueden resumir en la tabla:

```{r}
d3_ <- datos %>%
group_by(FUTURO2,OPINION) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

kable(d3_,caption ="Variables OPINION y FUTURO2",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE)
```

Los datos de la tabla anterior se simplifican gracias al siguiente gráfico:

```{r echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:ord3} Gráfico de barras OPINION-FUTURO2",fig.pos="H"}

ggplot(data = d3_[-c(1:4),],
       mapping = aes(x = factor(FUTURO2),y = Porcentaje*100,
                     fill = factor(OPINION))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "Positividad ante cambios en 10 años", y = "Porcentaje", 
       fill = "Nuevas generaciones") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5))
```

Se obtienen las medidas de asociación:

```{r}
tabla3_=table(datos$OPINION,datos$FUTURO2)
tabla3_=tabla1_[-1,-1]

e3=KendallTauA(tabla3_, conf.level = 0.95)
f3=KendallTauB(tabla3_, conf.level = 0.95)
g3=StuartTauC(tabla1_, conf.level = 0.95)
h3=GoodmanKruskalGamma(tabla3_, conf.level = 0.95)
i3=SomersDelta(tabla3_, direction="column", conf.level = 0.95)
j3=SomersDelta(tabla3_, direction="row", conf.level = 0.95)

k3=rbind.data.frame(e3,f3,g3,h3,i3,j3)
rownames(k3)=c("$\\tau_a$ de Kendall","$\\tau_b$ de Kendall",
               "$\\tau_c$ de Stuart","$\\gamma$ de Goodman y Kruskal",
               "$d_{OPINION}$ de Sommers","$d_{FURURO2}$ de Sommers")
colnames(k3)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(k1,caption ="Medidas de variables OPINION y FUTURO2", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Igual, ¿por qué sale negativo?

### CLASESOCIAL - ESTUDIOS

En este caso, se analiza la asociación entre la clase social con el nivel de estudios de las personas. Se observa la siguiente tabla y gráfica:

```{r}
d4_ <- datos %>%
group_by(ESTUDIOS,CLASESOCIAL) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

kable(d4_,caption ="Variables CLASE SOCIAL y ESTUDIOS",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE)%>%
column_spec(2,width = "5cm")
```

```{r echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:ord4} Gráfico de barras CLASE SOCIAL-ESTUDIOS",fig.pos="H"}

ggplot(data = d4_[-c(1,2),],
       mapping = aes(x = factor(ESTUDIOS),y = Porcentaje*100,
                     fill = factor(CLASESOCIAL))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "Nivel alcanzado de estudios", y = "Porcentaje", 
       fill = "Clase Social") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5))
```

Las medidas que se han calculado son:

```{r}
tabla4_=table(datos$CLASESOCIAL,datos$ESTUDIOS)
tabla4_=tabla4_[-1,-1]

e4=KendallTauA(tabla4_, conf.level = 0.95)
f4=KendallTauB(tabla4_, conf.level = 0.95)
g4=StuartTauC(tabla4_, conf.level = 0.95)
h4=GoodmanKruskalGamma(tabla4_, conf.level = 0.95)
i4=SomersDelta(tabla4_, direction="column", conf.level = 0.95)
j4=SomersDelta(tabla4_, direction="row", conf.level = 0.95)

k4=rbind.data.frame(e4,f4,g4,h4,i4,j4)
rownames(k4)=c("$\\tau_a$ de Kendall","$\\tau_b$ de Kendall",
               "$\\tau_c$ de Stuart","$\\gamma$ de Goodman y Kruskal",
               "$d_{CLASESOCIAL}$ de Sommers","$d_{ESTUDIOS}$ de Sommers")
colnames(k4)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(k4,caption ="Medidas de variables CLASESOCIAL y ESTUDIOS", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Para cada una de las medidas se obtiene que la asociación es significativa, por tanto, conociendo la respuesta sobre el nivel de educación o la clase social, se reduce la incertidumbre en la predicción, al menos, un 15.82%.

### ESCIDEOL - EDAD

Se realiza el mismo procedimiento con las variables Escalón Ideológico y el rango de edad.

```{r}
d5_ <- datos %>%
group_by(ESCIDEOL,EDAD) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

kable(d5_,caption ="Variables EDAD y ESCIDEOL",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE)
```

```{r echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:ord5} Gráfico de barras EDAD-ESCIDEOL",fig.pos="H"}

ggplot(data = d5_[-(1:6),],
       mapping = aes(x = factor(ESCIDEOL),y = Porcentaje*100,
                     fill = factor(EDAD))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "Escalón Ideológico", y = "Porcentaje", 
       fill = "Eadad") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5))
```

Medidas:

```{r}
tabla5_=table(datos$ESCIDEOL,datos$EDAD)
tabla5_=tabla5_[-1,]

e5=KendallTauA(tabla5_, conf.level = 0.95)
f5=KendallTauB(tabla5_, conf.level = 0.95)
g5=StuartTauC(tabla5_, conf.level = 0.95)
h5=GoodmanKruskalGamma(tabla5_, conf.level = 0.95)
i5=SomersDelta(tabla5_, direction="column", conf.level = 0.95)
j5=SomersDelta(tabla5_, direction="row", conf.level = 0.95)
  
k5=rbind.data.frame(e5,f5,g5,h5,i5,j5)
rownames(k5)=c("$\\tau_a$ de Kendall","$\\tau_b$ de Kendall",
               "$\\tau_c$ de Stuart","$\\gamma$ de Goodman y Kruskal",
               "$d_{ESCIDEOL}$ de Sommers","$d_{EDAD}$ de Sommers")
colnames(k5)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(k5,caption ="Medidas de variables ESCIDEOL y EDAD", 
      row.names = T,escape = FALSE, digits = rep(4,3)) %>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
                position = "center",full_width = T)
```

Aunque las medidas resulten sen todas muy bajas, no existen evidencias para concluir que no haya asociación.

### SISTEMAUTOM2 - FUTURO1

Ahora es el turno de ver cómo se afectan mutuamente la variable que mide la cantidas de cambios sociales y económicos de aquí a diez años con el aumento del número de robots y sistemas automáticos usados en las empresas en los próximos diez años.

Un análisis descritivo de los datos:

```{r}
d7_ <- datos %>%
group_by(FUTURO1,SISTEMAUTOM2) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=Total/sum(Total))

kable(d7_,caption ="Variables SISTEMAUTOM2 y FUTURO1",longtable=TRUE) %>%
  row_spec(0, bold=T, background='gray!6',align='c') %>%
  kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
position = "center",
repeat_header_text="(contin\\'ua)",
full_width = FALSE)%>%
column_spec(1,width = "4cm")
```

Para facilitar su interpretación, se representa el siguiente gráfico:

```{r echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:ord7} Gráfico de barras FUTURO1-SISTEMAUTOM2",fig.pos="H"}

ggplot(data = d7_[-(1:6),],
       mapping = aes(x = factor(FUTURO1),y = Porcentaje*100,
                     fill = factor(SISTEMAUTOM2))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "Cambios en 10 años", y = "Porcentaje", 
       fill = "Aumento del número de robots 
       y sistemas automáticos") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5))
```

Para estas variables ordinales, se obtienen las medidas de asociación:

```{r}
tabla7_=table(datos$SISTEMAUTOM2,datos$FUTURO1)
tabla7_=tabla7_[-1,-1]

e7=KendallTauA(tabla7_, conf.level = 0.95)
f7=KendallTauB(tabla7_, conf.level = 0.95)
g7=StuartTauC(tabla7_, conf.level = 0.95)
h7=GoodmanKruskalGamma(tabla7_, conf.level = 0.95)
i7=SomersDelta(tabla7_, direction="column", conf.level = 0.95)
j7=SomersDelta(tabla7_, direction="row", conf.level = 0.95)
  
k7=rbind.data.frame(e7,f7,g7,h7,i7,j7)
rownames(k7)=c("$\\tau_a$ de Kendall","$\\tau_b$ de Kendall",
               "$\\tau_c$ de Stuart","$\\gamma$ de Goodman y Kruskal",
               "$d_{SISTEMAUTOM2}$ de Sommers","$d_{FUTURO1}$ de Sommers")
colnames(k7)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(k7,caption ="Medidas de variables SISTEMAUTOM2 y FUTURO1", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Como todas las medidas son significativas, se puede concluir que existe asociación entre ambas variables.

### ESCIDEOL - CLASESOCIAL

Por último, se estudia si se produce asociación entre la puntuación que una persona da sobre si su ideología es más de izquierda o derecha (del 1 al 10) y la clase social a la que pertenece. Se obtiene el siguiente gráfico de barras:

```{r}
d8_ <- datos %>%
group_by(ESCIDEOL,CLASESOCIAL) %>% # agrupa por variables
summarise(Total=n()) %>% # resume calculando nuevas variables
mutate(Porcentaje=round(Total/sum(Total),4))

# kable(d8_,caption ="Variables ESCIDEL e CLASE SOCIAL",longtable=TRUE) %>%
#   row_spec(0, bold=T, background='gray!6',align='c') %>%
#   kable_styling(latex_options = c("repeat_header","condensed","hold_position"),
# position = "center",
# repeat_header_text="(contin\\'ua)",
# full_width = FALSE)
```

```{r echo=FALSE,out.width='15cm',fig.align='center',fig.cap="\\label{fig:ord8} Gráfico de barras ESCIDEOL-CLASESOCIAL",fig.pos="H"}

ggplot(data = d8_[-(1:6),],
       mapping = aes(x = factor(ESCIDEOL),y = Porcentaje*100,
                     fill = factor(CLASESOCIAL))) + 
  geom_bar(position = 'dodge', colour="black", stat = 'identity') +
  labs(x = "Escalón Ideológico", y = "Porcentaje", 
       fill = "Clase Social") +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5))
```

A través del gráfico y la tabla resumen se contempla, que si hubiera asociación, puede ser debido a que las personas de clase más baja se decantan más hacia ideologías de izquierdas mientras que las clase sociales más altas hacia ideologías más de derechas.

Comprobamos si existe asociación a través de las distintas medidas:

```{r}
tabla8_=table(datos$ESCIDEOL,datos$CLASESOCIAL)
tabla8_=tabla8_[,-1]

e8=KendallTauA(tabla8_, conf.level = 0.95)
f8=KendallTauB(tabla8_, conf.level = 0.95)
g8=StuartTauC(tabla8_, conf.level = 0.95)
h8=GoodmanKruskalGamma(tabla8_, conf.level = 0.95)
i8=SomersDelta(tabla8_, direction="column", conf.level = 0.95)
j8=SomersDelta(tabla8_, direction="row", conf.level = 0.95)
  
k8=rbind.data.frame(e8,f8,g8,h8,i8,j8)
rownames(k8)=c("$\\tau_a$ de Kendall","$\\tau_b$ de Kendall",
               "$\\tau_c$ de Stuart","$\\gamma$ de Goodman y Kruskal",
               "$d_{ESCIDEOL}$ de Sommers","$d_{CLASESOCIAL}$ de Sommers")
colnames(k8)=c("Estadístico","Límite Inferior IC","Límite Superior IC")

kable(k8,caption ="Medidas de variables ESCIDEOL y CLASESOCIAL", 
      row.names = T,escape = FALSE, digits = rep(4,3))%>%
  kable_styling(latex_options = c("striped", "condensed","hold_position"),
position = "center",
full_width = T)
```

Afectivamente, todas las medidas de asociación indican que existe asociación entre ambas variables, aunque , en este caso, la asociación no es demasiado destacable.

Desde un punto de vista general, a partir de todos los ejemplos mostrados, se observa que la medida $\tau_a$ es la menos significativa y la medida $\gamma$ de Goodman y Kruskal la que más.

## Medidas de Asociación Nominal (dicotómica) - Ordinal

Aquí va Cureton y S de Withfield (si la encuentro)

```{r}
library(irt)
#cuidado hay que quitar los NS/NC
biserial(xtfrm(datos$INESTADO), xtfrm(datos$ESCIDEOL), method="rank")
```
